# this comand to build docker ( Must delete nodemodule ) 
    docker compose --env-file ./Server-api-temp/.env up --build -d

# .env need
   PORT = 8886
    ## for conect to database    
    MONGODB_URL 
    ## for conect to google login    
    CLIENT_ID 
    SECRET_ID 
    REDIRECTURL
    ## for decrypt token     
    TOKEN_KEY 
    ## for define superadmin     
    SUPERADMIN 

# DON'T EDIT ON SERVER 
# this is resource of database
https://drive.google.com/drive/folders/1U48LxWkWvqCJZ7NMeB_8Ss_AhZm54cAt?usp=sharing


หน้าบ้านต้องการ Env ใหม่
1.VITE_WSURL ให้ใส่ /busws ตามหลัง ip
2.VITE_STATIONWSURL ให้ใส่ /stationws ตามหลัง ip
3.VITE_SRCHEATMAP = https://maps.googleapis.com/maps/api/js?key=&libraries=visualization
4.VITE_WEBSOCKETKEY = มาถามกู

หลังบ้านต้องการ Env ใหม่
1.WEBSOCKETKEY = มาถามกู
2.BEARER_TOKEN = มาถามกู || ดูเอาจาก commit ก่อนเพราะกูเผลอเอาลง





เพื่อให้ websocket ส่งข้อมูลแบบ realtime ต้องไป config mongo ก่อน
1. ในไฟล์ mongod.conf ให้ใส่ จากนั้น save 
replication:
   replSetName: rs0
(in docker must generate keyfile "openssl rand -base64 756 > /mongo/keyFile" and "chmod 400 /mongo/keyFile") 

(in container use this command "mongod --config /etc/mongod.conf")

2. ให้หยุด mongo ก่อน คำสั่ง windows ส่วน linux ไม่บอกกกกกกกกกกก
  net stop MongoDB

4. ให้เปิด mongo ใหม่
 net start MongoDB

5. connect to mongo replace <credentials> with username:password
  "mongodb://<credentials>@127.0.0.1:27017/?directConnection=true&serverSelectionTimeoutMS=2000&appName=mongosh+2.2.6"
=======================================================================================================
# เมื่อdeploy
1. openssl rand -base64 756 > mongo/keyFile
2. chmod 400 mongo/keyFile
4. ปิด CMD ใน mongo/Dockerfile 
5. docker compose up -d --build
6. docker exec -it gems-react-database-1 bash
7. chown mongodb:mongodb /etc/mongo.key (ใน container)
8. exit
9. เปิด CMD ใน mongo/Dockerfile2
10. docker compose down && docker compose up -d --build
11. docker exec -it gems-react-database-1 mongosh -u <user> -p <password> (เปลี่ยน <user> กับ <password> ให้ตรงกับที่เราตั้งไว้)
12. rs.initiate()
13. rs.status()
14. exit

if MongoServerError[InvalidReplicaSetConfig]: Our replica set config is invalid or we are not a member of it when running rs.initiate()
1. ให้เข้า mongo shell ใน container
# 10.1.216.115 is ip address of server
2. พิมพ์ rs.reconfig({
  _id: "rs0",
  version: 2,
  members: [
    { _id: 0, host: "10.1.216.115:27017" } 
  ]
}, { force: true })

3. พิมพ์ rs.initiate()
4. พิมพ์ rs.status()
5. ออกจาก mongo shell และ container
